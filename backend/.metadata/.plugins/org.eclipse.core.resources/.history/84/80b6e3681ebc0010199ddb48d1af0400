package com.example.demo.services;

import java.util.List;
import java.util.Optional;

import org.springframework.stereotype.Service;

import com.example.demo.entity.User;
import jakarta.transaction.Transactional;
import lombok.RequiredArgsConstructor;
import com.example.demo.repository.UserRepository;

@Service
@Transactional
@RequiredArgsConstructor
public class UserService implements IUserService {

	private final UserRepository userRepository;

	@Override
	public User saveUser(User user) {
		if (user.getId() != null) {
		Optional<User> existingUser = userRepository.findById(user.getId());
		if (existingUser.isPresent()) {
			throw new RuntimeException("User with ID " + user.getId() + " already exists.");
			}
		}
		
		user.setActive(true);
		
		return userRepository.save(user);

	}

	@Override
	public List<User> getAllUsers() {
		
		List<User> users = userRepository.findAll();
		if (users.isEmpty()) {
			throw new RuntimeException("No users found.");
		}
		
		return users;
		
	}

	@Override
	public User getUserById(Long id) {
		
		return userRepository.findById(id)
				.orElseThrow(() -> new RuntimeException("User not found."));
	}

	@Override
	public User updateUser(User user) {
		
		User existingUser = userRepository.findById(user.getId())
				.orElseThrow(()-> new RuntimeException("User not found."));
		
		existingUser.setUsername(user.getUsername());
		existingUser.setEmail(user.getEmail());
		existingUser.setPassword(user.getPassword());
		return userRepository.save(existingUser);
	}

	@Override
	public void deleteUser(Long id) {
		
		User existingUser = userRepository.findById(id)
				.orElseThrow(() -> new RuntimeException("User not found."));
		
		
		existingUser.setActive(false);
		
		userRepository.delete(existingUser);
		
	}
	
	public User activateUser(Long id) {
		User user = userRepository.findById(id)
				.orElseThrow(() -> new RuntimeException("User with ID " + id + " not found."));
		
		user.setActive(true);
		return userRepository.save(user);
	}

	
}